<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.kuqi.Mapper.AdminBackstageMapper">
  <resultMap id="BaseResultMap" type="cn.kuqi.Pojo.Users">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 11 14:40:37 CST 2018.
    -->
    <id column="U_ID" jdbcType="INTEGER" property="uId" />
    <result column="U_Name" jdbcType="VARCHAR" property="uName" />
    <result column="U_Nickname" jdbcType="VARCHAR" property="uNickname" />
    <result column="U_Signature" jdbcType="VARCHAR" property="uSignature" />
    <result column="U_Email" jdbcType="VARCHAR" property="uEmail" />
    <result column="U_Psw" jdbcType="CHAR" property="uPsw" />
    <result column="U_RegisterTime" jdbcType="VARCHAR" property="uRegistertime" />
    <result column="U_Permission" jdbcType="INTEGER" property="uPermission" />
  </resultMap>
  
  <resultMap type="cn.kuqi.Pojo.ArticleClassfiy" id="ClassfiyResultMap">
		<id column="AC_Number" property="acNumber" />
		<result column="AC_ClassfiyName" property="acClassfiyname" />
		<result column="AC_Remark" property="acRemark"/>
  </resultMap>
  
  <resultMap id="ClassfiyResult" type="cn.kuqi.Pojo.ArticleClassfiy">
    <id column="AC_Number" jdbcType="INTEGER" property="acNumber" />
    <result column="AC_ClassfiyName" jdbcType="VARCHAR" property="acClassfiyname" />
    <result column="AC_Remark" jdbcType="VARCHAR" property="acRemark" />
  </resultMap>
  
  <!-- 查询所有的文章的list的映射 -->
  <resultMap type="cn.kuqi.Pojo.ArticleExt" id="QueryArticleList">
  	<collection property="data" ofType="Article">
  		<id column="A_Number"  property="aNumber" />
	    <result column="A_ID" property="aId" />
	    <result column="A_ViewCount" property="aViewcount" />
	    <result column="A_Title" property="aTitle" />
	    <result column="A_Praise" property="aPraise" />
	    <result column="A_Content" property="aContent" />
	    <result column="A_Trample" property="aTrample" />
	    <result column="A_PublishTime" property="aPublishtime" />
	    <result column="A_CollectedCount" property="aCollectedcount" />
	    <result column="A_Type" property="aType" />
  	</collection>
  </resultMap>
  
  <!-- 文章 -->
  <resultMap type="cn.kuqi.Pojo.Article" id="QueryArticle">
 	<id column="A_Number"  property="aNumber" />
    <result column="A_ID" property="aId" />
    <result column="A_ViewCount" property="aViewcount" />
    <result column="A_Praise" property="aPraise" />
    <result column="A_Title" property="aTitle" />
    <result column="A_Content" property="aContent" />
    <result column="A_Trample" property="aTrample" />
    <result column="A_PublishTime" property="aPublishtime" />
    <result column="A_CollectedCount" property="aCollectedcount" />
    <result column="A_Type" property="aType" />
    <result column="A_Status" property="aStatus" />
    <result column="A_CommentCount" property="aCommentcount" />
  </resultMap>
  
  <!-- 友情链接 -->
  <resultMap id="LinkResultMap" type="cn.kuqi.Pojo.Link">
    <id column="L_Number" property="lNumber" />
    <result column="L_Name" property="lName" />
    <result column="L_AddTime" property="lAddtime" />
    <result column="L_ClickCount" property="lClickcount" />
    <result column="L_Link" property="lLink" />
    <result column="L_Show" property="lShow" />
  </resultMap>
  
  <!-- 博客信息 -->
  <resultMap id="BlogInfoResultMap" type="cn.kuqi.Pojo.Bloginfo">
    <id column="BI_Number" property="biNumber" />
    <result column="BI_BlogerNickname" property="biBlogernickname" />
    <result column="BI_HeadPortrait" property="biHeadportrait" />
    <result column="BI_BlogName" property="biBlogname" />
    <result column="BI_Antistop" property="biAntistop" />
    <result column="BI_Motto" property="biMotto" />
    <result column="BI_Theme" property="biTheme" />
  </resultMap> 
  
  <resultMap id="getBlogInfoJoinTheme" type="cn.kuqi.Pojo.BlogInfoJoinTheme" extends="BlogInfoResultMap">
  	<association property="theme" javaType="cn.kuqi.Pojo.Theme">
 		<id column="T_Number" jdbcType="INTEGER" property="tNumber" />
   		<result column="T_Title" jdbcType="VARCHAR" property="tTitle" />
  	</association>
  </resultMap>
  
  <!-- 用户实体类信息 -->
  <resultMap id="UsersResultMap" type="cn.kuqi.Pojo.Users">
    <id column="U_ID" property="uId" />
    <result column="U_Name" property="uName" />
    <result column="U_Nickname" property="uNickname" />
    <result column="U_Signature" property="uSignature" />
    <result column="U_Email" property="uEmail" />
    <result column="U_Psw" property="uPsw" />
    <result column="U_RegisterTime" property="uRegistertime" />
    <result column="U_Permission" property="uPermission" />
  </resultMap>
  
  <!-- 用户实体类List -->
  <resultMap type="cn.kuqi.Pojo.UsersExt" id="UsersResultList">
  	<collection property="data" ofType="cn.kuqi.Pojo.Users">
 		<id column="U_ID" property="uId" />
	    <result column="U_Name" property="uName" />
	    <result column="U_Nickname" property="uNickname" />
	    <result column="U_Signature" property="uSignature" />
	    <result column="U_Email" property="uEmail" />
	    <result column="U_Psw" property="uPsw" />
	    <result column="U_RegisterTime" property="uRegistertime" />
	    <result column="U_Permission" property="uPermission" />
  	</collection>
  </resultMap>
  
  <!-- 通过用户名查询Users  -->
  <select id="QueryUserInfoByName" parameterType="java.lang.String" resultMap="BaseResultMap">
  		select * from users where U_Name= #{username}
  </select>
  
  <!-- 通过邮箱查询Users  -->
  <select id="QueryUserInfoByEmail" parameterType="java.lang.String" resultMap="BaseResultMap">
  		select * from users where U_Email= #{email}
  </select>
  
  <!-- 查询所有的文章分类 -->
  <select id="QueryAllClassfiy" resultMap="ClassfiyResultMap">
  		select * from article_classfiy limit ${now},${max}
  </select>
  
  <!-- 查询分类所有记录数 -->
  <select id="QueryCountClassfiy" resultType="integer">
  		select count(*) from article_classfiy
  </select>
  
  <!-- 查询单个文章分类 -->
  <select id="QueryOneClassfiy" resultMap="ClassfiyResult" parameterType="integer">
  		select * from article_classfiy where AC_Number = #{number}
  </select>
  
  <!-- 添加分类 -->
  <insert id="InsertClassfiy">
  		insert into article_classfiy (AC_ClassfiyName,AC_Remark) value(#{Name},#{Remark})
  </insert>
  
  <!-- 修改查询分类 -->
  <select id="SelectArtcleClassfiyByNumber" parameterType="int" resultMap="ClassfiyResult">
  		select * from article_classfiy where AC_Number = #{Number}
  </select>
  
  <!-- 修改分类 -->
  <update id="UpdataArtcleClassfiyByNumber">
		UPDATE article_classfiy SET AC_ClassfiyName = #{ClassfiyName}, AC_Remark = #{ClassfiyRemark} WHERE AC_Number = #{Number}   
  </update>
  
  <!-- 删除分类 -->
  <delete id="DeleteArtcleClassfiyByNumber">
  		delete from article_classfiy where AC_Number=${number}
  </delete>
  
  <!-- 查询所有文章 -->
  <select id="QueryAllArticle" resultMap="QueryArticle">
  		select * from article limit ${now},${max}
  </select>
  
  <!-- 查询所有未发布的文章 -->
  <select id="QueryAllDraft" resultMap="QueryArticle">
  		select * from article where A_Status = 0 limit ${now},${max}
  </select>
  
   <!-- 查询未发布文章的所有记录数 -->
  <select id="QueryAllDraftCount" resultType="integer">
  		select count(*) from article where A_Status = 0
  </select>
  
  <!-- 查询分类所有记录数 -->
  <select id="QueryCountArticle" resultType="integer">
  		select count(*) from article
  </select>
  
  <!-- 查询单篇文章 -->
  <select id="QueryArticleByNumber" resultMap="QueryArticle">
  		select * from article where A_Number=#{Number}
  </select>
  
  <!-- 查询文章所有的评论记录数 -->
  <select id="QueryArticleAllComment" resultType="integer">
  		select count(*) from user_comment 
  </select>
  
  <!-- 删除单篇文章 -->
  <delete id="DeleteArticleByNumber">
  		delete from article where A_Number=#{Number}
  </delete>
  
  <!-- 修改单篇文章 -->
  <update id="UpdataArticleByNumber">
		UPDATE article SET A_Content = #{Content} WHERE A_Number = #{Number}   
  </update>
  
  <!-- 通过分类来查找文章 -->
  <select id="QueryArticleByClassfiy" resultMap="QueryArticleList">
  		select article.* from article where A_ID=#{ClassfiyNumber}
  </select>
  
  <!-- 发博客 -->
  <insert id="AddArticle" parameterType="cn.kuqi.Pojo.Article">
  		insert into article(A_ID,A_Title,A_Content,A_ViewCount,A_Praise,A_Trample,A_PublishTime,A_CollectedCount,A_Type) value(${aId},'${aTitle}','${aContent}',${aViewcount},${aPraise},${aTrample},'${aPublishtime}',${aCollectedcount},${aType})
  </insert>
  
  <!-- 添加友链 -->
  <insert id="addLink" parameterType="cn.kuqi.Pojo.Link">
  		insert into link(
  			L_Name,
  			L_AddTime,
  			L_ClickCount,
  			L_Link,
  			L_Show
  		) 
  		value(
  			'${lName}',
  			'${lAddtime}',
  			${lClickcount},
  			'${lLink}',
  			'${lShow}'
  		)
  </insert>
  
  <!-- 查询友链 信息 多 -->
  <select id="queryLinks" resultMap="LinkResultMap">
  		select 
  			*
  		from 
  			link 
  		<where>
  			<if test="lName != null and lName != ''">
  				L_Name = '${lName}'
  			</if>
  			<if test="lLink != null and lLink != ''">
  				L_Link = '${lLink}'
  			</if>
  			<if test="lNumber != null and lNumber != ''">
  				L_Number = '${lNumber}'
  			</if>
  		</where>
  		limit 
  			${now},
  			${max}
  </select>
  
  <!-- 查询所有条数 -->
  <select id="queryAllLinks" resultMap="LinkResultMap">
  		select 
  			*
  		from 
  			link 
  </select>
  
  
  <!-- 删除友链 -->
  <delete id="deleteLinkByNumber">
  		delete 
  		from 
  			link 
  		where 
  			L_Number=#{Number}
  </delete>
  
  <!-- 修改友链信息 -->
  <update id="alterLinkByNumber" parameterType="cn.kuqi.Pojo.Link">
		UPDATE link
			<trim prefix="set" suffixOverrides=",">
				<if test="lName != null and lName != ''">
					L_Name = '${lName}',
				</if> 
				<if test="lLink != null and lLink != ''">
					L_Link = '${lLink}',
				</if>
				<if test="lShow != null">
					L_Show = ${lShow}
				</if>
			</trim>
		WHERE
			L_Number = ${lNumber}
  </update>
  
  <!-- 修改博客的信息 -->
  
  <!-- 查询 -->
  <select id="queryBlogInfoByNumber" resultMap="getBlogInfoJoinTheme">
  		select 
	  		BI_BlogerNickname,
	  		BI_HeadPortrait,
	  		BI_BlogName,
	  		BI_Antistop,
	  		BI_Motto,
	  		BI_Theme,
	  		T_Title 
  		from 
  			bloginfo 
  		Left Join 
  			theme 
  		on 
  			bloginfo.BI_Theme = theme.T_Number
  		and 
  			bloginfo.BI_Number = 1
  </select>
  
  <!-- 修改 -->
  <update id="alterBlogInfoByNumber">
		UPDATE bloginfo  
		
		<set>
			<if test="biBlogernickname != null and biBlogernickname != ''">
				BI_BlogerNickname = '${biBlogernickname}',
			</if>
			<if test="biHeadportrait != null and biHeadportrait != ''">
				BI_HeadPortrait = '${biHeadportrait}',
			</if>
			<if test="biBlogname != null and biBlogname != ''">
				BI_BlogName = '${biBlogname}',
			</if>
			<if test="biAntistop != null and biAntistop != ''">
				BI_Antistop = '${biAntistop}',
			</if>
			<if test="biMotto != null and biMotto != ''">
				BI_Motto = '${biMotto}'
			</if>
		</set>
		
		WHERE
		
		BI_Number = 1 
  </update>
  
  
  
  <!-- 用户综合查询 -->
  <select id="QueryUsersInfoByAllData" parameterType="cn.kuqi.Pojo.Users" resultMap="UsersResultMap">
	select U_ID,U_Name,U_Nickname,U_Email,U_RegisterTime,U_Permission from users 
	<where>
		<if test="uId != null">
			U_ID = ${uId}
		</if>
		<if test="uName != null">
			and U_Name = '${uName}'
		</if>
		<if test="uEmail != null">
			and U_Email = '${uEmail}'
		</if>
		<if test="uNickname != null">
			and U_Nickname like '%${uNickname}%'
		</if>
	</where>
  </select>
  
  <!-- 分页查询所有用户 -->
  <select id="queryAllUser" resultMap="UsersResultMap">
  		select 
  			U_ID,
  			U_Name,
  			U_Nickname,
  			U_Email,
  			U_Psw,
  			U_RegisterTime,
  			U_Permission 
  		from 
  			users 
  		<where>
  			<if test="uId != null">
  				U_ID = '${uId}'
	  		</if>
	  		<if test="uName != null and uName != ''">
	  			U_Name = '${uName}'
	  		</if>
	  		<if test="uEmail != null and uEmail != ''">
	  			U_Email = '${uEmail}'
	  		</if>
  		</where>
  		limit 
  			${now},
  			${max}
  </select>
  
  <select id="queryCountUser" resultType="integer">
  		select 
  			count(*)
  		from 
  			users
  </select>
  
  
  <!-- 删除用户 -->
  <delete id="deleteUserByUID">
  		delete 
  		from 
  			users 
  		where 
  			U_ID = #{ID}
  </delete>
  
  <!-- 修改用户信息 -->
  <update id="AlterUserInfo">
		UPDATE users  
		
		<trim prefix="set" suffixOverrides=",">
			<if test="uName != null">
				U_Name = '${uName}',
			</if>
			<if test="uNickname != null">
				U_Nickname = '${uNickname}',
			</if>
			<if test="uSignature != null">
				U_Signature = '${uSignature}',
			</if>
			<if test="uEmail != null">
				U_Email = '${uEmail}',
			</if>
			<if test="uPsw != null">
				U_Psw = '${uPsw}',
			</if>
			<if test="uPermission != null">
				U_Permission = ${uPermission}
			</if>
		</trim>
		
		WHERE
		
		U_ID = ${uId}   
  </update>
  
  <!-- 单个用户查询  -->
  <select id="QueryUserInfoByID" parameterType="cn.kuqi.Pojo.Users" resultMap="UsersResultMap">
		select * from users where U_ID = ${uId}
  </select>
  
  
</mapper>